# 구현 계획

## 개요

시도별·시군구별·월별 보행자 사고 데이터 기반 교통 안전 분석 대시보드를 구현합니다. 복잡한 기능보다는 핵심 가치를 제공하는 세 가지 주요 기능에 집중합니다: 1) 횡단보도 + 신호등 시각화, 2) 개선된 팝업, 3) 사고 히트맵. 프론트엔드에서 실시간으로 안전/위험 지표를 계산하여 백엔드 복잡성을 최소화합니다.

## 구현 작업

- [ ] 1. Spring Boot 백엔드 프로젝트 설정
  - Spring Boot 3.x 프로젝트 생성 및 의존성 설정 (JPA, Security, JWT, Lombok, PostgreSQL)
  - Supabase PostgreSQL 연결 설정 및 JPA 구성
  - Spring Security 및 JWT 기반 인증 기본 설정
  - 기본 프로젝트 구조 생성
  - _요구사항: 5.5, 12.1_

- [ ] 2. 데이터베이스 스키마 및 엔티티 구현
  - [ ] 2.1 기본 테이블 스키마 생성
    - crosswalks, acc, district_all 테이블 생성 (Supabase)
    - users, suggestions 테이블 생성
    - 인덱스 및 제약조건 설정
    - _요구사항: 5.4, 3.2, 8.1_

  - [ ] 2.2 기본 JPA 엔티티 클래스 구현
    - Crosswalk, AccidentData, User 엔티티 작성
    - Suggestion, SuggestionType, SuggestionStatus enum 구현
    - Lombok 어노테이션 적용
    - _요구사항: 5.2, 5.3, 1.4_

  - [ ]* 2.3 속성 테스트 - 데이터 저장 무결성 작성
    - **속성 8: 데이터 저장 무결성**
    - **검증: 요구사항 5.4**

- [ ] 3. 데이터 처리 서비스 구현
  - [ ] 3.1 CSV 파싱 서비스 구현
    - 한글 인코딩 처리 로직
    - 필수 필드 검증 로직
    - _요구사항: 5.1, 5.2, 5.3_

  - [ ]* 3.2 속성 테스트 - CSV 파싱 라운드트립 작성
    - **속성 7: CSV 파싱 라운드트립**
    - **검증: 요구사항 5.1, 5.2, 5.3**

  - [ ] 3.3 데이터 임포트 서비스 구현
    - DataImportService 클래스 작성
    - 배치 처리 및 트랜잭션 관리
    - _요구사항: 5.4_

- [ ] 4. 지도 데이터 API 구현
  - [ ] 4.1 지도 범위 기반 데이터 조회 API 구현
    - 횡단보도 조회 엔드포인트 (bounds 파라미터)
    - 사고 데이터 조회 엔드포인트 (bounds 파라미터)
    - 지리적 경계 검증 로직
    - _요구사항: 1.1, 1.3_

  - [ ]* 4.2 속성 테스트 - 지도 범위 데이터 로딩 정확성 작성
    - **속성 1: 지도 범위 데이터 로딩 정확성**
    - **검증: 요구사항 1.1, 1.3**

  - [ ] 4.3 횡단보도 상세 정보 API 구현
    - 개별 횡단보도 상세 조회 엔드포인트
    - 근처 사고 데이터 포함 로직
    - _요구사항: 2.2, 2.3_

  - [ ]* 4.4 속성 테스트 - 팝업 정보 정확성 작성
    - **속성 2: 팝업 정보 정확성**
    - **검증: 요구사항 2.2, 2.3**

- [ ] 5. JWT 기반 인증 및 보안 구현
  - [ ] 5.1 Spring Security JWT 설정 구현
    - SecurityConfig 클래스 작성 (JWT 기반 인증)
    - JwtTokenProvider, JwtAuthenticationFilter 구현
    - JWT 토큰 생성, 검증, 갱신 로직
    - CORS 설정 및 API 접근 제어
    - _요구사항: 12.1, 12.2, 8.3_

  - [ ] 5.2 사용자 인증 서비스 구현
    - CustomUserDetailsService 구현
    - CustomUserPrincipal 클래스 구현
    - 사용자 비밀번호 암호화 및 검증
    - 리프레시 토큰 관리 로직
    - _요구사항: 12.1, 12.5_

  - [ ] 5.3 JWT 인증 API 구현
    - 로그인/로그아웃 API 구현 (JWT 토큰 발급/무효화)
    - 토큰 갱신 API 구현
    - AuthController 구현 (회원가입, 사용자 정보 조회)
    - JWT 기반 사용자 정보 반환 API
    - _요구사항: 12.3, 12.4, 12.5_

  - [ ]* 5.4 속성 테스트 - JWT 인증 상태 관리 작성
    - **속성 6: JWT 토큰 인증 상태 관리**
    - **검증: 요구사항 12.2, 12.4**

- [ ] 6. 건의사항 관리 API 구현
  - [ ] 6.1 건의사항 CRUD API 구현
    - 건의사항 생성, 조회, 수정 엔드포인트
    - 페이징 및 필터링 지원
    - _요구사항: 3.1, 3.2_

  - [ ] 6.2 건의사항 상호작용 API 구현
    - 좋아요, 댓글 기능 엔드포인트
    - 조회수 증가 로직
    - _요구사항: 3.5_

  - [ ] 6.3 관리자 건의사항 관리 API 구현
    - 건의사항 상태 변경 엔드포인트
    - 관리자 답변 및 처리 로직
    - _요구사항: 8.1, 8.2, 8.3_

  - [ ]* 6.4 속성 테스트 - 건의사항 관리 작성
    - **속성 5: 건의사항 상태 관리 정확성**
    - **검증: 요구사항 3.2, 8.3**

- [ ] 7. 체크포인트 - 백엔드 핵심 로직 테스트
  - 모든 테스트가 통과하는지 확인하고, 문제가 있으면 사용자에게 문의

- [x] 8. Next.js 프론트엔드 프로젝트 설정
  - Next.js 16 프로젝트 생성 및 TypeScript 설정
  - Tailwind CSS, Leaflet, Leaflet.heat 의존성 설치
  - 기본 프로젝트 구조 및 라우팅 설정 (App Router)
  - _요구사항: 7.1_

- [x] 9. Next.js API 라우트 구현
  - [x] 9.1 백엔드 프록시 API 라우트 작성
    - 지도 데이터, 사고 데이터 프록시
    - 환경변수를 통한 백엔드 URL 설정
    - 세션 쿠키 전달을 위한 credentials 설정
    - _요구사항: 1.1, 1.3_

  - [x] 9.2 인증 관련 API 라우트 구현
    - JWT 기반 로그인/로그아웃 API 프록시
    - 사용자 정보 조회 및 인증 상태 확인 API
    - Authorization 헤더 기반 JWT 토큰 전달
    - _요구사항: 12.1, 12.3, 12.5_

- [x] 10. 인터랙티브 지도 UI 구현
  - [x] 10.1 EnhancedMapView 컴포넌트 구현
    - Leaflet 지도 통합 및 횡단보도 마커 표시
    - 지도 범위 변경시 동적 데이터 로딩
    - 마커 클러스터링 기능
    - _요구사항: 1.1, 1.2, 1.3_

  - [x] 10.2 개선된 팝업 시스템 구현
    - EnhancedCrosswalkPopup 컴포넌트
    - 안전/위험 지표 실시간 계산 및 표시
    - 시각적 점수 바 및 시설 정보 표시
    - _요구사항: 2.1, 2.2, 2.3_

  - [x] 10.3 히트맵 레이어 구현
    - Leaflet.heat 플러그인 통합
    - 사고 데이터 기반 히트맵 생성
    - 히트맵 토글 기능
    - _요구사항: 9.1, 9.4_

  - [ ]* 10.4 속성 테스트 - 히트맵 데이터 정확성 작성
    - **속성 4: 히트맵 데이터 정확성**
    - **검증: 요구사항 9.1, 9.2**

- [ ] 11. 건의사항 게시판 UI 구현
  - [ ] 11.1 건의사항 목록 및 상세 페이지 구현
    - 건의사항 목록 페이지 (페이징, 필터링, 정렬)
    - 건의사항 상세 페이지 (지도 위치 표시)
    - _요구사항: 3.1, 3.4_

  - [ ] 11.2 건의사항 작성 폼 구현
    - 지도에서 위치 선택 기능
    - 건의 유형 및 내용 입력 폼
    - 현재 시설 현황 자동 표시
    - _요구사항: 3.2, 3.3_

  - [ ] 11.3 관리자 건의사항 관리 페이지 구현
    - 건의사항 상태 관리 대시보드
    - 관리자 답변 및 처리 기능
    - 건의사항 통계 및 현황 표시
    - _요구사항: 8.1, 8.2, 8.4_

- [x] 12. 사용자 인증 및 권한 관리 UI 구현
  - [x] 12.1 기본 레이아웃 및 인증 UI 구현
    - Root layout 구현 (app/layout.tsx)
    - Header 컴포넌트 구현 (네비게이션, 사용자 프로필)
    - 로그인 페이지 구현 (app/signin/page.tsx)
    - Root 페이지 구현 (app/page.tsx)
    - _요구사항: 12.1, 12.5_

  - [ ] 12.2 JWT 기반 로그인 기능 구현
    - 이메일/비밀번호 로그인 폼
    - 회원가입 기능 구현
    - JWT 토큰 기반 사용자 상태 관리
    - 자동 토큰 갱신 및 로그인 상태 확인
    - _요구사항: 12.1, 12.2, 12.5_

  - [ ] 12.3 권한별 UI 제어 구현
    - ADMIN 권한별 메뉴 분리
    - 권한에 따른 기능 접근 제어
    - JWT 토큰 만료 시 자동 로그아웃 처리
    - _요구사항: 12.4, 8.3_

- [ ] 13. 데이터 임포트 기능 구현
  - [ ] 13.1 데이터 업로드 UI 구현
    - 횡단보도 및 사고 데이터 CSV 업로드 인터페이스
    - 데이터 검증 및 중복 체크 기능
    - _요구사항: 5.1, 5.2_

  - [ ] 13.2 데이터 검증 및 미리보기 기능
    - 업로드된 데이터 미리보기 테이블
    - 필드 매핑 및 검증 결과 표시
    - 데이터 일관성 검증
    - _요구사항: 5.2, 5.3_

- [ ] 14. 최종 체크포인트 - 전체 시스템 테스트
  - 모든 테스트가 통과하는지 확인하고, 문제가 있으면 사용자에게 문의

- [ ] 15. 성능 최적화 및 배포 준비
  - [ ] 15.1 Next.js 16 빌드 최적화
    - 이미지 최적화 및 코드 스플리팅
    - 정적 생성 및 서버 사이드 렌더링 설정
    - 데이터 캐싱 전략 구현
    - Next.js 16 새로운 성능 최적화 기능 활용
    - _요구사항: 7.1_

  - [ ] 15.2 Spring Boot 프로덕션 설정
    - 프로덕션 데이터베이스 설정
    - 로깅 및 모니터링 구성
    - 보안 설정 강화
    - _요구사항: 5.5_